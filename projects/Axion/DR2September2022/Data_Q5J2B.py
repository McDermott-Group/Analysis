from datetime import datetime
from scipy import signal
from dataChest import *
import os
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
import matplotlib
matplotlib.use('TkAgg')

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-05-22\PSD_Q5_J2B
# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-06-22\PSD_Q5_J2B
biases_data = [-0.11073999999999999, -0.08329999999999996, -0.07545999999999996, -0.06369999999999995, -0.06761999999999994, -0.10093999999999997, -0.06957999999999995, -0.08721999999999996, -0.08917999999999997, -0.10681999999999998, -0.1225, -0.07741999999999996, -0.08133999999999997, -0.09505999999999998, -0.11661999999999999, -0.10877999999999999, -0.12054, -0.07937999999999996, -0.10289999999999998, -0.07349999999999995, -0.09701999999999998, -0.09113999999999997, -0.11465999999999998, -0.1127, -0.11857999999999999, -0.08525999999999996, -0.10485999999999998, -0.09897999999999997, -0.06565999999999995, -0.07153999999999995, -0.09309999999999997, 0.07154000000000003, -0.09113999999999997, 0.09114, -0.026459999999999914, 0.02842, 0.0029400000000001114, -0.30379999999999996, -0.06957999999999995, 0.10289999999999999, 0.09898, 0.08918, -0.12054, -0.016659999999999904, 0.07546, -0.08133999999999997, -0.05193999999999994, -0.05389999999999994, 0.05586, 0.03626000000000001, 0.018619999999999998, 0.06566000000000002, -0.006859999999999897, 0.03234, 0.034300000000000004, -0.09897999999999997, 0.10878000000000002, -0.05781999999999994, -0.0107799999999999, -0.05585999999999994, -0.04801999999999993, -0.046059999999999934, -0.07545999999999996, -0.10779999999999977, 0.05586000000000002, 0.1225, 0.02450000000000013, -0.018619999999999907, 0.06566, 0.020580000000000126, 0.00294, -0.16659999999999983, -0.016659999999999904, 0.01274000000000012, 0.02646, 0.04606000000000001, -0.06369999999999995, -0.11857999999999999, 0.10486000000000001, 0.08722000000000005, 0.10682000000000001, 0.11661999999999999, -0.08525999999999996, -0.30379999999999996, 0.008820000000000116, -0.06173999999999995, -0.024499999999999914, -0.1225, 0.038220000000000004, 0.016659999999999998, 0.04410000000000001, -0.028419999999999918, -0.04899999999999972, -0.008819999999999899, -0.08819999999999975, -0.059779999999999944, -0.00294, 0.018620000000000126, -0.000979999999999892, -0.1273999999999998, -0.02253999999999991, -0.10877999999999999, 0.08330000000000004, -0.012739999999999902, -0.2645999999999999, -0.11465999999999998, 0.05978000000000003, 0.12054, -0.10485999999999998, 0.08525999999999999, -0.08133999999999997, 0.0931, 0.061739999999999996, 0.00098, -0.1273999999999998, -0.10093999999999997, 0.006860000000000115, -0.10681999999999998, -0.03821999999999993, 0.06762000000000003, 0.08721999999999999, 0.09702000000000001, -0.030379999999999917, -0.04213999999999993, 0.07742, 0.048020000000000014, -0.2841999999999999, -0.008819999999999899, -0.05585999999999994, -0.00098, -0.09897999999999997, 0.00686, -0.11661999999999999, 0.022539999999999998, 0.05978000000000001, 0.06370000000000003, 0.06957999999999999, 0.09702000000000001, -0.20579999999999984, -0.0293999999999997, -0.11465999999999998, -0.34299999999999997, 0.07546000000000004, 0.03626000000000001, -0.10485999999999998, -0.08819999999999975, -0.06173999999999995, -0.07937999999999996, -0.08329999999999996, -0.08721999999999996, -0.024499999999999914, 0.10486, -0.18619999999999984, -0.03429999999999992, -0.049979999999999934, -0.09701999999999998, -0.03233999999999992, -0.014699999999999904, 0.04018000000000001, 0.0049000000000001135, 0.10682, 0.05194000000000001, -0.07153999999999995, 0.028420000000000133, 0.11074, -0.0107799999999999, -0.1469999999999998, -0.3626, 0.07350000000000004, 0.07938000000000005, 0.057820000000000024, -0.11661999999999999, 0.061740000000000024, 0.11465999999999998, -0.018619999999999907, 0.07938, -0.03429999999999992, -0.11073999999999999, -0.05389999999999994, 0.06958000000000003, 0.044100000000000014, 0.026460000000000133, -0.11073999999999999, 0.024499999999999997, 0.07153999999999999, -0.06859999999999973, -0.04899999999999972, -0.07349999999999995, -0.09113999999999997, -0.036259999999999924, -0.09505999999999998, 0.0735, -0.009799999999999682, -0.07741999999999996, -0.07545999999999996, 0.05194000000000002, -0.09309999999999997, 0.01078, -0.10779999999999977, -0.3626, 0.0009800000000001097, 0.09114, -0.08721999999999996, 0.08134000000000004, -0.10289999999999998, -0.049979999999999934, -0.11857999999999999, -0.04801999999999993, 0.08329999999999999, -0.10093999999999997, -0.06565999999999995, 0.03234, -0.08917999999999997, -0.08917999999999997, -0.0029399999999998937, -0.020579999999999907, -0.006859999999999897, -0.24499999999999988, -0.014699999999999904, -0.09505999999999998, -0.028419999999999918, -0.04409999999999993, 0.04802, 0.0049, -0.18619999999999984, 0.0147, -0.059779999999999944, 0.02254000000000013, -0.026459999999999914, -0.1225, 0.016660000000000123, -0.07937999999999996, -0.036259999999999924, 0.030380000000000004, 0.012740000000000001, 0.1127, -0.04409999999999993, 0.049980000000000004, 0.0637, -0.0293999999999997, 0.08526000000000004, 0.06761999999999999, -0.07349999999999995, 0.034300000000000004, -0.32339999999999997, -0.04213999999999993, -0.24499999999999988, -0.030379999999999917, -0.10681999999999998, 0.12054, -0.009799999999999682, 0.10878, -0.09701999999999998, -0.20579999999999984, 0.1225, -0.03233999999999992, -0.004899999999999896, 0.11857999999999999, -0.046059999999999934, 0.11857999999999999, 0.04998000000000002, -0.020579999999999907, 0.046060000000000004, -0.09309999999999997, -0.040179999999999924, 0.053899999999999997, -0.06369999999999995, -0.07741999999999996, -0.012739999999999902, 0.02058, -0.1127, 0.1029, -0.06565999999999995, -0.05781999999999994, 0.10094, -0.040179999999999924, -0.34299999999999997, -0.22539999999999988, 0.05390000000000002, 0.0931, 0.008820000000000001, 0.09506, -0.05193999999999994, -0.06761999999999994, -0.2841999999999999, 0.07742000000000004, -0.10877999999999999, -0.1469999999999998, 0.04018, -0.16659999999999983, 0.09897999999999998, -0.07153999999999995, 0.010780000000000118, 0.03822, 0.042140000000000004, 0.08134, 0.04214000000000001, 0.05782, 0.09506, -0.06761999999999994, 0.014700000000000121, -0.06859999999999973, -0.22539999999999988, -0.0049, -0.12054, -0.06957999999999995, -0.10289999999999998, 0.10093999999999999, -0.08525999999999996, -0.32339999999999997, -0.02253999999999991, -0.03821999999999993, -0.1127, -0.08329999999999996, -0.2645999999999999]
parity_rate_data =[1296.0949896723541, 603.1753014167397, 289.0274813941571, 556.3412919256104, 339.89811472789137, 1171.625479731675, 295.29978406962465, 566.047143858423, 647.4672198767306, 1207.0765718738419, 2021.8370838659812, 331.59399393154405, 579.3597605459657, 851.7678120205107, 1617.7274043200503, 1195.5395233395943, 1835.4351894444412, 463.05222828864265, 1111.3348913224008, 287.36058997567574, 916.7226982617294, 698.9474523828826, 1617.7471356438891, 1550.7972535443248, 1785.3360208154772, 636.6840349677367, 1124.8064499969662, 1113.8343802066422, 448.15708540677093, 274.97275406391276, 764.7730860907068, 301.2064158680899, 728.7479578153573, 834.0425163078781, 272.42677940775064, 333.3819216610802, 134.65274313812233, 40.337949849102614, 330.026117044851, 1178.9286657899556, 1271.652444203869, 669.9184846512665, 1904.598000947346, 200.95577137882506, 319.37273671991596, 590.4009014160372, 457.0736062726403, 714.1858082228993, 820.5300693101277, 805.919045376194, 248.03132881695484, 428.9621964593179, 103.34163725263357, 464.8329089121441, 599.4788504997451, 1089.0141434318612, 1449.9429442006779, 1122.9348043287757, 119.83551971182024, 742.359140714928, 368.63322440563303, 393.4743491840681, 334.03106012293057, 1283.5054991887941, 864.1058547486439, 1925.0173978889393, 295.3527539850211, 345.7432022777067, 414.8329160702682, 342.6790059886254, 107.81104670746495, 3614.2592150605924, 205.47542842849148, 146.31714955004892, 268.24719706439237, 352.94495280060926, 608.5043299458871, 1637.9460045879312, 1410.03318974038, 604.0986689387545, 1404.068185591649, 1779.622825597508, 679.7616021140406, 50.672086687315, 140.130834312075, 766.8648279547497, 251.71802647554046, 1867.3274923945405, 1013.9309692762138, 168.68784930578633, 480.51752799336094, 306.5298334829083, 350.59149904815087, 111.6462766437163, 612.0466253458856, 911.0990659595719, 103.65249715279198, 272.51181089401206, 117.33181056433973, 2204.0084163596916, 294.14222254789644, 1195.0585645353362, 654.7608048596778, 108.46082018938648, 348.6687912311336, 1439.558615056488, 878.1600122842966, 1972.289981506595, 1081.3060861752558, 694.9562274640627, 582.5501025296247, 879.0213165214406, 760.4003661705012, 115.82523118030143, 2307.5252344711016, 1076.9466150625724, 145.29677811278134, 1209.0243470359733, 925.9981131916562, 351.55113116496767, 637.9681038687057, 1074.2005073360892, 392.8330290261832, 884.5133830875992, 417.60212421233666, 379.6426316231477, 42.54765416833615, 104.77493786654023, 741.313008499574, 120.45983324873899, 1102.0445831858788, 95.4269281166595, 1720.044585430511, 293.9238671926485, 904.4977840114482, 594.3960069812181, 278.0687943264725, 1078.1741780711684, 23.365396704908463, 340.89127931726625, 1671.2259166875608, 173.02479490057806, 287.62254498178675, 755.9870983495601, 1064.0983673235285, 650.1637025424568, 740.0671589578631, 475.10953701893254, 639.2617185344732, 583.0425545069279, 265.33071564637834, 1253.1206072053194, 4024.4720616143386, 558.2825599652275, 432.1124364494782, 866.6606623828337, 443.0153739734168, 141.99903729811533, 946.2588865885381, 144.27979358775266, 1214.0186748380024, 489.4364881030731, 316.8724739765569, 374.8164217831096, 1605.4712523712114, 101.7811238605513, 3208.0847110115624, 126.34984436842608, 308.9411895429868, 454.7799505646329, 1123.9538097864686, 1614.429364789214, 747.0333959121103, 1716.5125330314816, 319.8342380342225, 475.2549146268194, 595.6229431911241, 1299.8590824869095, 724.9244965681239, 308.3615714249165, 498.5971336368923, 290.497777896631, 1263.476165245244, 244.90656039286023, 296.7387886817229, 313.01101999558233, 372.23856732253273, 308.05436442630526, 725.6219272053899, 723.6868142527308, 853.9750530369082, 316.73752797077697, 94.77964444260537, 352.9129402928623, 318.714576624736, 500.95258908770717, 733.9043807316965, 40.71689272691627, 1310.697898907902, 157.23265825543817, 128.46462024402032, 779.8187247245851, 580.7580984245628, 662.8987355817446, 1085.5093773681226, 398.48189123340063, 1688.6102010364407, 354.05169624037677, 662.3951536966389, 1078.044480410303, 479.64504897223657, 465.6055305352598, 634.3842873328123, 620.7521395468124, 105.702850691213, 409.95598927053453, 103.34491393707764, 217.74726439773133, 142.57101770469097, 845.9771133180672, 320.0432342637166, 587.6481283690565, 361.91024869898985, 95.59975117670635, 20.25298210849727, 119.84376352822187, 917.5171523706364, 336.043094600031, 288.64396299794504, 1808.0532316340925, 212.82601428769584, 472.61615649708835, 674.8239811820572, 428.63869473789197, 107.04609944176126, 1806.504690288807, 546.4425414017022, 351.6071793988336, 583.3176584952068, 349.27534111446283, 671.3958588741406, 320.06769583324035, 286.8167280286189, 581.1125942190923, 155.85233262987362, 876.2786396964239, 508.41629052637677, 377.1596514212859, 1180.2943314400718, 2092.5262257628488, 84.51059827742581, 1321.4019054117473, 891.501094606805, 24.637373742239834, 2115.2213632682488, 458.14347669796933, 104.28545779191946, 1657.7406333012611, 381.6945052924948, 1922.4424208696187, 423.3789225602916, 414.6869743263313, 352.64507542924747, 748.7061309597651, 897.174724956409, 694.5779593235202, 613.6474598990468, 360.24806257910836, 110.572503198508, 308.3764022758823, 1557.0409972678322, 1299.7746010448573, 479.4659995110507, 1106.0960069139192, 1173.366665068961, 18.080228021923848, 492.80404530512345, 42.17254139475663, 742.9143041675944, 870.5516328312038, 90.53944844131158, 963.2432774867682, 436.8147618780767, 351.39965156905555, 977.6527575521253, 416.963229310713, 1184.2487412901448, 41.72699365515707, 992.9203257216993, 18.889331737548687, 1194.7693602592512, 291.7785630071074, 137.24946890948442, 968.2380246056596, 764.3645197025756, 653.6815422387093, 818.0846197953199, 1186.75023516431, 912.0046487965619, 371.41101384785856, 178.71904645722347, 320.7605424152988, 28.988367423101074, 95.43184273813809, 1770.8423756509926, 336.6110754148159, 1077.4857106828283, 1170.7893770821581, 697.9030333287466, 178.01241453440792, 306.6335875450627, 933.5488164456918, 1592.4958099295657, 597.211431074419, 47.19189711760283]

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-11-22\PSD_Q5_Baseline
# [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
# [60.732344609884954, 59.44377197144836, 67.29315423372181, 69.07233644023734, 53.97220286118778, 60.77589875745641, 61.31335931975884, 72.15128279266784, 69.2834208169464, 66.49268248139916, 67.04097465132874, 57.10161595686007, 55.60306911144726, 63.18091885545868, 65.88351080017472, 70.28125307705953, 63.21284723126024, 63.38747299541136, 63.23217225711905, 62.79445713958879, 73.77618189574419, 60.58084317025473, 71.4864110589149, 59.751965796440956, 65.09944945192687, 62.580479850878405, 62.072393133615435, 66.39794303882604, 48.20288081363064, 61.705402144225886, 62.71894043366991]

biases=[]
parity_rate=[]
for i in range(len(parity_rate_data)):
    if parity_rate_data[i] < 5000 and parity_rate_data[i] > 50:
        biases.append(biases_data[i])
        parity_rate.append(parity_rate_data[i])

# biases1 = []
# parity_rate1 = []
# for i in range(len(parity_rate_data1)):
#     if parity_rate_data1[i] < 5000 and parity_rate_data1[i] > 200:
#         biases1.append(biases_data1[i])
#         parity_rate1.append(parity_rate_data1[i])


plt.title('Parity Rate vs Radiator Bias')
# plt.plot(4*times, np.abs(I + Q * 1j))
# plt.semilogy([np.abs(b/0.49) for b in biases1], parity_rate1,marker='o',linestyle='None')
plt.semilogy([np.abs(b/0.49) for b in biases], parity_rate,marker='+',linestyle='None')

plt.grid(which='both')
plt.ylim(0.5e2,4.5e3)
plt.xlim(0,0.4)
# plt.xlabel('Radiator Bias (mV)')
plt.xlabel('Radiator Bias (mV)')
plt.ylabel('Parity Rate (Hz)')
plt.pause(0.1)

