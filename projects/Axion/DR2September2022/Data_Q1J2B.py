from datetime import datetime
from scipy import signal
from dataChest import *
import os
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
import matplotlib
matplotlib.use('TkAgg')

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\09-30-22\PSD_Q1_J2B_Retightened
biases_data = [-0.07499999999999979, -0.26999999999999996, 0.07000000000000034, 0.16500000000000042, -0.15999999999999986, 0.19500000000000045, -0.11999999999999983, -0.0849999999999998, 0.09500000000000036, -0.0799999999999998, 0.28500000000000053, 0.12000000000000038, 0.20500000000000046, 2.7755575615628914e-16, 0.06500000000000034, -0.25999999999999995, -0.09999999999999981, -0.285, -0.23499999999999993, 0.11000000000000038, -0.024999999999999745, 0.010000000000000286, -0.24499999999999994, 0.030000000000000304, 0.1350000000000004, -0.01999999999999974, 0.03500000000000031, 0.29500000000000054, -0.12499999999999983, 0.08000000000000035, 0.15500000000000042, -0.0899999999999998, -0.16499999999999987, 0.22500000000000048, 0.1300000000000004, 0.05000000000000032, 0.020000000000000295, 0.2400000000000005, 0.11500000000000038, 0.17500000000000043, 0.005000000000000282, 0.29000000000000054, 0.2750000000000005, -0.034999999999999754, 0.2500000000000005, -0.0949999999999998, 0.30000000000000054, 0.2450000000000005, -0.1949999999999999, -0.25499999999999995, -0.22499999999999992, 0.18000000000000044, -0.11499999999999982, 0.2700000000000005, 0.04500000000000032, 0.06000000000000033, -0.059999999999999776, 0.2600000000000005, -0.06499999999999978, -0.12999999999999984, 0.10500000000000037, 0.09000000000000036, -0.1899999999999999, 0.08500000000000035, 0.0250000000000003, -0.10499999999999982, -0.26499999999999996, 0.2350000000000005, -0.2099999999999999, -0.23999999999999994, -0.009999999999999731, 0.22000000000000047, 0.21500000000000047, 0.17000000000000043, -0.2049999999999999, -0.14499999999999985, -0.03999999999999976, 0.2650000000000005, -0.24999999999999994, -0.27999999999999997, -0.10999999999999982, 0.18500000000000044, -0.2149999999999999, 0.10000000000000037, -0.16999999999999987, -0.02999999999999975, -0.27499999999999997, 0.1450000000000004, -0.05499999999999977, -0.1849999999999999, 0.07500000000000034, 0.1250000000000004, -0.04499999999999976, -0.3, -0.22999999999999993, 0.19000000000000045, 0.21000000000000046, -0.1999999999999999, 0.2800000000000005, -0.15499999999999986, 0.2550000000000005, 0.23000000000000048, -0.014999999999999736, -0.004999999999999727, 0.1500000000000004, -0.13499999999999984, -0.17999999999999988, 0.015000000000000291, -0.29, 0.16000000000000042, -0.21999999999999992, -0.04999999999999977, 0.1400000000000004, -0.14999999999999986, 0.20000000000000046, -0.13999999999999985, 0.04000000000000031, -0.06999999999999978, -0.17499999999999988, 0.055000000000000326, -0.295]
parity_rate_data = [1437.2207812198092, 33.06654643669875, 1401.5021296403013, 1578.5756548559332, 2624.2505335399137, 1604.0022904745026, 1415.4499375380165, 1776.546063160596, 1915.5245503108465, 36.8498476863945, 3446.8301321761965, 2319.2098758799248, 2053.453124411227, 1469.4590415010396, 1216.9960135221106, 4015.071083732722, 1391.0961411265444, 37.99068887264147, 3009.4802613740526, 2070.4351286315627, 1612.1893356297853, 835.0970759720217, 4480.165606263556, 1039.6742152638622, 1616.4578109312797, 1286.169070817317, 1108.880614888883, 33.178552756604844, 1426.5612174287044, 1392.8954284451977, 2314.5621197935243, 37.13690247543623, 2290.1084172834503, 2277.7772673882296, 1660.5682805070803, 1170.9505442162745, 937.1796028615245, 1934.0838131314508, 2668.755780600753, 1259.3835207174097, 1059.9664785373348, 4071.662045081773, 4620.90563656555, 2034.245529896683, 2936.70751894278, 1608.9485780084717, 32.445802217562225, 2105.8593113549337, 2843.696197719268, 4616.443702819461, 4622.1034954298975, 1313.8150169221944, 1281.1192650768376, 3096.6511867548575, 1106.9586996289672, 1111.2290354057532, 1407.988354708403, 3645.285369640539, 2053.0763664051756, 1525.3817753373742, 2011.5141538730797, 1447.6592644062582, 3327.1940553165987, 1348.1778031166607, 897.5522269059951, 1264.990603955939, 38.22227888260219, 2146.4246303934156, 2766.4324320740648, 3406.480259885136, 1805.905466688959, 2143.8246206303884, 1842.7513467570468, 1495.0138409367298, 2821.2223596144504, 1588.1341582222299, 1870.1057176405634, 3744.714008303229, 3479.9138803210362, 30.377829290889, 1149.1202753109799, 1552.2613057376384, 2862.623875031653, 2196.165499388951, 2483.094356965057, 2228.379569756214, 26.180593771717206, 1998.989061771992, 1372.7653071705497, 2412.2093059773215, 1500.7366376225593, 1787.2985329747883, 2310.581150606379, 39.55547540691397, 2803.5953297572237, 1735.771894196263, 2161.6321928191, 2801.4354661444263, 3524.29966098443, 1873.770161113091, 2502.9122774250727, 2202.0804491134377, 1577.2237106273292, 2251.7037457347183, 2103.8657370263404, 1688.3311062213202, 2583.5544394019153, 980.1931344989841, 26.328779843772562, 1651.764316242926, 2876.865823673903, 1628.7072607035109, 1651.6294686074898, 1722.9473903529822, 1920.985140084417, 1676.988009251291, 1215.2279199325696, 3146.0061533951834, 2484.3611698337404, 1016.5894481050432, 25.838992710670702]

biases_data1  = [-0.06467999999999995, 0.04214000000000014, -0.08035999999999996, -0.029399999999999916, -0.05879999999999994, -0.07545999999999996, 0.0009800000000001097, -0.09015999999999998, 0.05586000000000016, -0.09799999999999998, 0.05194000000000015, -0.10387999999999999, -0.12152, -0.04213999999999993, -0.10681999999999998, -0.06957999999999995, 0.005880000000000114, 0.06076000000000016, -0.025479999999999912, -0.10877999999999999, -0.03919999999999992, -0.005879999999999897, 0.07056000000000016, -0.050959999999999936, -0.05193999999999994, -0.1225, 0.007840000000000116, -0.06761999999999994, 0.06958000000000017, 0.014700000000000121, 0.026460000000000133, 0.07350000000000018, -0.04311999999999993, 0.049000000000000155, 0.05684000000000016, -0.08623999999999997, -0.08133999999999997, -0.03429999999999992, -0.03331999999999992, 0.0029400000000001114, 0.05978000000000016, -0.09603999999999997, 0.020580000000000126, 0.08624000000000018, 0.039200000000000144, -0.000979999999999892, -0.08329999999999996, 0.03234000000000014, 0.07644000000000017, -0.0107799999999999, -0.026459999999999914, 1.0880185641326534e-16, -0.017639999999999906, -0.09407999999999997, -0.03527999999999992, 0.05488000000000016, -0.07643999999999995, -0.10583999999999999, -0.04409999999999993, 0.04704000000000015, -0.10779999999999998, -0.12054, -0.008819999999999899, -0.09995999999999998, -0.006859999999999897, -0.07937999999999996, 0.021560000000000128, -0.06565999999999995, -0.003919999999999895, -0.08917999999999997, 0.03626000000000014, -0.020579999999999907, -0.08427999999999997, 0.016660000000000123, 0.08918000000000019, -0.023519999999999913, -0.040179999999999924, 0.07252000000000017, 0.04606000000000015, 0.07742000000000017, 0.03528000000000014, 0.07938000000000017, 0.01568000000000012, 0.03332000000000014, 0.04116000000000015, -0.05585999999999994, 0.06762000000000017, 0.02548000000000013, 0.04508000000000015, -0.02253999999999991, -0.06663999999999995, -0.09701999999999998, 0.08428000000000019, -0.04507999999999993, 0.05880000000000016, -0.004899999999999896, -0.08525999999999996, 0.07448000000000017, -0.036259999999999924, 0.07546000000000018, 0.06370000000000016, -0.030379999999999917, -0.11367999999999999, -0.018619999999999907, 0.02450000000000013, -0.07839999999999996, -0.05683999999999994, -0.03233999999999992, -0.028419999999999918, -0.014699999999999904, 0.034300000000000136, 0.08820000000000018, -0.054879999999999936, -0.016659999999999904, 0.08722000000000019, 0.052920000000000154, 0.08232000000000018, -0.001959999999999893, 0.02744000000000013, 0.006860000000000115, 0.023520000000000128, 0.013720000000000121, -0.09897999999999997, -0.01959999999999991, 0.028420000000000133, -0.009799999999999899, -0.11857999999999999, 0.029400000000000134, -0.049979999999999934, 0.06468000000000017, 0.040180000000000146, 0.07154000000000017, 0.017640000000000124, 0.06860000000000017, 0.04998000000000015, -0.05389999999999994, 0.08330000000000018, 0.04802000000000015, 0.010780000000000118, 0.019600000000000124, -0.10093999999999997, 0.07840000000000018, -0.027439999999999916, -0.09211999999999997, -0.07251999999999996, -0.007839999999999897, 0.03724000000000014, 0.02254000000000013, 0.01176000000000012, -0.07153999999999995, -0.07349999999999995, -0.11956, -0.07741999999999996, 0.03136000000000014, -0.05781999999999994, -0.11465999999999998, 0.003920000000000113, -0.09309999999999997, 0.06174000000000016, -0.060759999999999946, -0.046059999999999934, 0.06664000000000017, 0.08526000000000018, 0.030380000000000136, -0.07447999999999996, -0.09505999999999998, 0.008820000000000116, 0.044100000000000146, 0.05096000000000015, -0.11073999999999999, 0.057820000000000156, -0.08721999999999996, 0.09016000000000018, -0.04703999999999993, -0.08231999999999996, -0.0029399999999998937, -0.06859999999999995, -0.05291999999999994, -0.10485999999999998, -0.03821999999999993, -0.11171999999999999, 0.009800000000000118, -0.02155999999999991, 0.018620000000000126, 0.08134000000000018, 0.03822000000000014, -0.09113999999999997, -0.04899999999999993, -0.024499999999999914, -0.10975999999999998, -0.012739999999999902, 0.01274000000000012, -0.0117599999999999, 0.08036000000000018, -0.11563999999999999, -0.10289999999999998, 0.06566000000000016, -0.041159999999999926, -0.037239999999999926, -0.013719999999999902, -0.015679999999999906, -0.06369999999999995, -0.07055999999999996, 0.0049000000000001135, -0.1127, -0.10191999999999998, -0.059779999999999944, -0.08819999999999997, -0.06271999999999994, -0.031359999999999916, -0.1225, -0.11661999999999999, -0.1176, 0.053900000000000156, 0.043120000000000144, 0.0019600000000001105, -0.04801999999999993, -0.06173999999999995, 0.06272000000000016]
parity_rate_data1 = [938.5556449858478, 1758.5033608655074, 1093.0344469189674, 1730.9935228970428, 1630.5021623511145, 856.2658893944944, 839.2457953265761, 1411.437114577877, 1638.2883539536253, 1664.4692502059265, 2260.321629984574, 1867.3331486019956, 3247.009094356949, 2016.110835442547, 2773.2297576419637, 903.4959234734224, 964.3162423529557, 1297.2641966550343, 890.2385701101097, 3185.171061553501, 1907.865395949799, 641.6247682382782, 796.497527576919, 891.6560029667644, 925.2492524461347, 2239.911130118741, 823.8003018871647, 839.0132732160185, 840.1604754743407, 701.5685951095347, 895.9497353866697, 942.5860386971954, 1526.8371012919938, 1207.1860696732556, 1394.6684918820977, 1445.2683887757498, 1156.4625296656902, 1093.122722196025, 2876.4149782419595, 807.5202883027669, 2084.287066656266, 1679.1927230992499, 1141.7486488355048, 1282.6297068193835, 3068.8322868195055, 546.6253691164197, 1451.977510668609, 1327.1811507125292, 1149.7268796523788, 674.5059116831927, 889.602472778845, 468.87342079851265, 698.8612825891645, 1600.6651581243875, 1157.0281788340953, 1247.0731641501384, 884.2418087147346, 2649.103404836825, 1232.947753702982, 1023.8659742765427, 2766.712517698653, 4198.328081513512, 665.745662299386, 1803.614751862763, 641.140643997905, 1083.4054472750836, 1014.8085514834622, 872.6051347738752, 672.3876470362512, 1316.7187224587976, 1316.4120997958653, 1304.3398262439425, 1510.3203664966622, 844.3635047858558, 1365.324484882487, 1411.5888847052418, 2130.7344812759156, 880.1258292826329, 765.9323015417169, 949.0288261549933, 1831.3841188003444, 1095.1832410047653, 787.7685536375136, 1477.7404350575687, 1407.2822347113374, 1281.130253055326, 881.7254764623344, 894.873315580371, 958.4020618530379, 1190.292152734327, 859.6144475437807, 1875.4975116469507, 1512.0003638814276, 952.2448034902319, 3228.9245892163003, 640.2224670900114, 1446.853789410875, 1052.976103817752, 2442.5312240339067, 1084.7179056570628, 1094.2753276436092, 1910.2157339432877, 1872.7677137461046, 759.5348367459899, 895.2514255973966, 960.7292968271372, 1376.3726643322775, 2205.4595135505315, 913.7551880129332, 715.6588471463426, 3813.1060974587776, 1414.6687459504913, 1249.5648051649252, 652.4593065217907, 1240.1755113069626, 1813.1524415185809, 1760.5074389390732, 622.6161214070562, 896.4168637123813, 1177.2349139835922, 1036.6746179623872, 602.2167774904927, 1728.0416892935013, 1223.985349904342, 944.6348248331883, 681.34727225151, 2218.8287928029613, 1075.3616910327441, 906.0909653137318, 1239.6603427081952, 2153.5453861250276, 863.6767156514187, 991.3517209931446, 850.2702287634781, 1468.7546420507338, 1140.3693008041573, 1191.2875857456477, 1239.602288077468, 750.4680745730466, 1123.8961277867502, 1714.8403112849699, 962.0849995917699, 862.341336021298, 1475.204513818187, 767.3178046249692, 668.6024104181081, 2790.450217630967, 988.7840101542608, 671.816250702069, 882.8042330514111, 920.9315069319122, 3964.405842823174, 938.0828800983156, 1215.9610760186572, 1408.4901374373821, 1942.5674130573545, 506.94226316495735, 1440.6312656072246, 1253.085063563647, 1315.4258516242035, 1000.2230336872507, 935.4392921371896, 1419.8516057895918, 1144.2381054255518, 807.9628999130516, 1737.1567376462426, 759.38189220445, 1749.0975897789874, 1866.4547905908225, 3507.4034009178154, 1386.9292468254187, 1585.6291719759258, 1270.8124864591537, 969.804829878776, 1354.556042200875, 668.8445274161818, 877.1860974506208, 1238.714488157356, 2173.4928111869895, 1540.5942756780369, 3323.170360425849, 735.7054883196053, 1125.5650641137986, 1122.7499405242131, 1538.394764212286, 2512.3054855234645, 1396.523486419362, 845.5215898111505, 957.0313688875416, 3300.8359285243628, 641.6915381393518, 694.4767213464037, 602.4738311125427, 1146.4118756541118, 2051.6668028043846, 1786.0015993220995, 1057.6290142991866, 2200.171204956437, 1109.6440714625971, 743.1539857409566, 940.8155604292488, 991.3476665052452, 954.3732871503205, 653.3173302452354, 2668.0748903697986, 1757.5702783429401, 1586.2098957865835, 1780.1191803143092, 1298.568630399104, 2091.752824832879, 3048.851358714067, 3383.3979928587514, 2743.389116266757, 1176.556954244013, 1843.8388168379217, 522.3124207823796, 925.1896506139426, 1472.6257692475872, 1887.6788889402974]

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-11-22\PSD_Q1_Baseline
# [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
# [420.70243580331345, 472.80497794761357, 362.35437506156154, 391.7409701921003, 418.92351569564164, 429.08453359955195, 438.3646944582902, 389.2420332946927, 440.5620401922427, 409.0494940105617, 472.52371787073236, 444.4145051306107, 601.5352780543293, 498.59554339343583, 428.7718810279105, 514.7847683424831, 422.3569752404693, 30.117494705683054, 848.0971336917588]


biases=[]
parity_rate=[]
for i in range(len(parity_rate_data)):
    if parity_rate_data[i] < 5000 and parity_rate_data[i] > 200:
        biases.append(biases_data[i])
        parity_rate.append(parity_rate_data[i])

biases1 = []
parity_rate1 = []
for i in range(len(parity_rate_data1)):
    if parity_rate_data1[i] < 5000 and parity_rate_data1[i] > 200:
        biases1.append(biases_data1[i])
        parity_rate1.append(parity_rate_data1[i])


plt.title('Parity Rate vs Radiator Bias')
# plt.plot(4*times, np.abs(I + Q * 1j))
plt.semilogy([np.abs(b/0.49) for b in biases1], parity_rate1,marker='o',linestyle='None')
plt.semilogy([np.abs(b-0.035) for b in biases], parity_rate,marker='+',linestyle='None')

plt.grid(which='both')
plt.ylim(2e2,4.5e3)
#plt.xlim(-600,600)
# plt.xlabel('Radiator Bias (mV)')
plt.xlabel('Radiator Bias (mV)')
plt.ylabel('Parity Rate (Hz)')
plt.pause(0.1)

