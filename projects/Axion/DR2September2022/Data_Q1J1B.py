from datetime import datetime
from scipy import signal
from dataChest import *
import os
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
import matplotlib
matplotlib.use('TkAgg')

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\09-29-22\PSD_Q1_J1B_Retightened
biases_data = [0.17000000000000043, -0.12999999999999984, -0.07499999999999979, -0.10999999999999982, 0.055000000000000326, 0.2650000000000005, -0.0899999999999998, -0.2049999999999999, -0.01999999999999974, -0.27999999999999997, 0.20000000000000046, 0.2350000000000005, 0.2800000000000005, 0.020000000000000295, -0.004999999999999727, 0.09500000000000036, -0.1949999999999999, -0.17499999999999988, -0.24999999999999994, -0.14999999999999986, 0.1250000000000004, 0.23000000000000048, 0.12000000000000038, 0.18000000000000044, 0.005000000000000282, 0.16000000000000042, 0.09000000000000036, -0.009999999999999731, 0.2600000000000005, 0.2750000000000005, -0.29, 0.22000000000000047, -0.059999999999999776, -0.26999999999999996, -0.12499999999999983, -0.10499999999999982, 0.07000000000000034, -0.06499999999999978, -0.034999999999999754, -0.03999999999999976, -0.1849999999999999, -0.21999999999999992, 0.10500000000000037, -0.06999999999999978, 0.1400000000000004, 0.2550000000000005, 0.04000000000000031, 0.030000000000000304, -0.15999999999999986, 0.1300000000000004, -0.2099999999999999, -0.1899999999999999, 0.19500000000000045, -0.16499999999999987, -0.27499999999999997, 0.1450000000000004, 0.22500000000000048, -0.13499999999999984, -0.3, -0.14499999999999985, 0.06500000000000034, -0.24499999999999994, 0.06000000000000033, -0.2149999999999999, 0.2400000000000005, 0.21000000000000046, 0.16500000000000042, 0.29000000000000054, 0.010000000000000286, -0.05499999999999977, 0.19000000000000045, 0.2700000000000005, 0.17500000000000043, 0.15500000000000042, 0.0250000000000003, -0.024999999999999745, -0.23999999999999994, -0.11499999999999982, 0.28500000000000053, 2.7755575615628914e-16, -0.295, -0.23499999999999993, -0.0949999999999998, 0.18500000000000044, 0.11000000000000038, -0.0799999999999998, 0.05000000000000032, 0.1350000000000004, 0.04500000000000032, 0.015000000000000291, 0.2500000000000005, 0.29500000000000054, 0.11500000000000038, -0.014999999999999736, 0.21500000000000047, 0.1500000000000004, -0.0849999999999998, 0.08500000000000035, 0.08000000000000035, -0.11999999999999983, 0.03500000000000031, -0.22999999999999993, -0.25999999999999995, -0.26499999999999996, -0.09999999999999981, -0.16999999999999987, 0.10000000000000037, -0.04999999999999977, 0.20500000000000046, -0.1999999999999999, -0.22499999999999992, -0.02999999999999975, -0.285, 0.07500000000000034, 0.30000000000000054, 0.2450000000000005, -0.17999999999999988, -0.04499999999999976, -0.13999999999999985, -0.25499999999999995, -0.15499999999999986]
parity_rate_data = [35.280209593227774, 25.154687620026156, 2572.0789166694426, 2558.429589262862, 1669.0606133654485, 28.487615423483867, 1801.5484538663613, 4216.583724169656, 2416.0291218931857, 44.070621254196865, 4962.588901141937, 4293.372964938837, 18.845678572639393, 1352.3943265327293, 1583.455390298299, 1889.1286853317815, 34.46725159808607, 3894.609568268092, 25.711644629140725, 3241.6859307060886, 2493.3439605292147, 30.406319208713985, 2810.902468848147, 23.217164272446183, 1544.2156420571157, 35.770392161607646, 2598.418814296954, 1718.0777966424746, 35.116563295283804, 23.113308298642206, 44.87521202722465, 34.28078896306452, 2194.677516307211, 39.01171867030399, 17.037363465118247, 2012.5307529897032, 4928.222881539207, 2004.143220608087, 2289.986645670792, 2028.950181951092, 4737.809289202915, 32.904455508861496, 1992.4902709955068, 2346.624199529216, 1938.3638738414102, 37.06523361149244, 1472.009747939066, 1468.6408623038258, 28.391178282800492, 2237.8876405079545, 30.475864091024373, 24.561283617458383, 2303.0712075294105, 4032.877614534697, 22.604408302630738, 1921.4404926428333, 23.984700270570308, 36.01809459053191, 50.6240656038857, 4723.549151210067, 2733.0539646069574, 28.674108878998844, 1729.4700026499002, 25.03613325069506, 32.347527187627456, 5383.412155658896, 5093.819191358802, 28.64339639684157, 1608.114916393838, 2027.2377210418344, 2677.70973304539, 25.49991276298872, 32.67351798483549, 4265.611876679898, 1413.9110889887477, 3205.668779467997, 36.41033705857791, 3517.208984093787, 22.1946957120636, 1616.389383065668, 28.29378219906176, 38.649312183259795, 1642.912198810695, 26.75433675390121, 1844.7557261536963, 2412.913816140698, 1516.9139671620928, 1878.621790587209, 1374.8103760713173, 1328.587241171849, 26.79330708345721, 35.26450679016774, 2420.3927082314462, 2095.493307513203, 3339.731148881074, 2219.3238960103286, 2297.7771189677974, 2772.817318988413, 3248.238377592552, 21.701863644552816, 1422.4372230556867, 17.138021866799775, 41.965699178736756, 20.729694329554295, 1725.9020052644346, 3941.931927157195, 2035.3858836453142, 1787.501075050677, 3386.115896978545, 32.63010643945797, 33.8280709691898, 2665.3374000157232, 27.654882704661, 4724.2098668245635, 22.013226451276847, 26.78255549367478, 4874.206981091472, 1915.7345732058486, 37.54411959059076, 37.44071901374195, 3305.5992463711013]

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-03-22\PSD_Q1_J1B
biases_data1 = [0.05488000000000016, -0.004899999999999896, 0.043120000000000144, -0.05879999999999994, 0.08526000000000018, -0.049979999999999934, -0.04213999999999993, 0.07056000000000016, -0.11563999999999999, 0.02548000000000013, -0.050959999999999936, -0.06271999999999994, -0.0029399999999998937, -0.020579999999999907, 0.06076000000000016, 0.034300000000000136, 0.039200000000000144, -0.12152, 0.017640000000000124, 0.014700000000000121, 0.04704000000000015, 0.12152000000000021, 0.018620000000000126, 0.03724000000000014, 0.0029400000000001114, 0.0999600000000002, 0.06370000000000016, -0.10191999999999998, -0.02253999999999991, 0.0911400000000002, 0.09212000000000019, -0.09603999999999997, 0.08232000000000018, -0.10975999999999998, 0.003920000000000113, 0.049000000000000155, -0.012739999999999902, 0.06860000000000017, 0.044100000000000146, 0.11172000000000021, -0.04507999999999993, 0.07350000000000018, -0.10093999999999997, -0.11367999999999999, 0.06468000000000017, 0.03528000000000014, 0.06958000000000017, 0.040180000000000146, -0.027439999999999916, -0.025479999999999912, -0.12347999999999999, 0.006860000000000115, 0.09702000000000019, -0.09211999999999997, 0.1078000000000002, -0.054879999999999936, 0.019600000000000124, 0.06272000000000016, 0.1058400000000002, -0.07251999999999996, 0.06762000000000017, -0.10583999999999999, -0.06859999999999995, -0.005879999999999897, -0.07839999999999996, -0.07643999999999995, 0.023520000000000128, -0.09015999999999998, 0.0980000000000002, 0.052920000000000154, 0.05978000000000016, -0.029399999999999916, -0.09897999999999997, -0.059779999999999944, -0.006859999999999897, -0.06957999999999995, 0.008820000000000116, 0.11368000000000021, 0.053900000000000156, 0.07546000000000018, 0.03234000000000014, -0.03527999999999992, -0.03919999999999992, -0.04801999999999993, 0.06664000000000017, -0.11857999999999999, -0.05291999999999994, -0.037239999999999926, 0.08722000000000019, 0.01568000000000012, 0.07252000000000017, 0.05194000000000015, -0.11073999999999999, -0.08231999999999996, -0.06369999999999995, -0.08427999999999997, -0.10681999999999998, -0.003919999999999895, -0.09309999999999997, 0.0049000000000001135, -0.009799999999999899, 0.07938000000000017, 0.1097600000000002, -0.11661999999999999, -0.0117599999999999, 0.04116000000000015, 0.08820000000000018, 0.05096000000000015, -0.015679999999999906, -0.07937999999999996, -0.017639999999999906, 0.05586000000000016, 0.08134000000000018, 0.07154000000000017, 0.0931000000000002, 0.08428000000000019, -0.11956, 0.08918000000000019, 0.10192000000000019, -0.08623999999999997, -0.05683999999999994, -0.08035999999999996, -0.09407999999999997, -0.001959999999999893, -0.014699999999999904, 0.04214000000000014, 0.11564000000000021, -0.1127, 0.04606000000000015, -0.09701999999999998, -0.09995999999999998, -0.028419999999999918, -0.10387999999999999, -0.08917999999999997, -0.05585999999999994, -0.09113999999999997, -0.01959999999999991, -0.03429999999999992, 0.03822000000000014, -0.06761999999999994, -0.10289999999999998, 0.021560000000000128, -0.046059999999999934, 0.030380000000000136, 0.0960400000000002, -0.05781999999999994, 0.029400000000000134, -0.02155999999999991, -0.10779999999999998, -0.060759999999999946, 0.03332000000000014, -0.07741999999999996, -0.08133999999999997, -0.07349999999999995, 0.09898000000000019, 0.057820000000000156, -0.09505999999999998, -0.06173999999999995, 0.1176000000000002, -0.030379999999999917, 0.09016000000000018, 0.009800000000000118, -0.06565999999999995, -0.07055999999999996, -0.031359999999999916, -0.08721999999999996, -0.007839999999999897, -0.04311999999999993, 0.07644000000000017, 0.0019600000000001105, 0.08330000000000018, 0.05880000000000016, -0.06467999999999995, 0.0009800000000001097, -0.026459999999999914, -0.07447999999999996, 0.08624000000000018, -0.05193999999999994, 0.1009400000000002, 0.11956000000000021, -0.10485999999999998, 0.09506000000000019, -0.040179999999999924, -0.1225, 0.010780000000000118, 0.026460000000000133, 0.06566000000000016, 0.07448000000000017, 0.02254000000000013, 0.08036000000000018, -0.04409999999999993, -0.024499999999999914, -0.06663999999999995, 0.01274000000000012, 0.013720000000000121, 0.03626000000000014, -0.04899999999999993, -0.08329999999999996, -0.09799999999999998, -0.10877999999999999, 0.07742000000000017, 1.0880185641326534e-16, 0.01176000000000012, 0.05684000000000016, -0.11465999999999998, 0.07840000000000018, -0.11171999999999999, -0.05389999999999994, -0.023519999999999913, -0.03233999999999992, -0.08819999999999997, -0.041159999999999926, 0.028420000000000133, -0.018619999999999907, -0.000979999999999892, -0.07545999999999996, 0.03136000000000014, 0.09408000000000019, -0.07153999999999995, -0.04703999999999993, -0.008819999999999899, 0.04802000000000015, -0.036259999999999924, -0.1176, 0.04508000000000015, 0.06174000000000016, 0.020580000000000126, 0.02744000000000013, -0.03821999999999993, 0.016660000000000123, -0.08525999999999996, 0.02450000000000013, -0.016659999999999904, -0.12054, 0.007840000000000116, 0.04998000000000015, -0.0107799999999999, -0.03331999999999992, 0.1038800000000002, 0.005880000000000114, -0.013719999999999902]
parity_rate_data1 = [1716.7033342473612, 755.6656747215391, 1109.7099302345607, 1126.3106605851133, 3890.8537233272164, 1562.5713046759859, 23.826458540230913, 23.78308899297641, 34.59038414785215, 46.31481511413208, 2079.887845510996, 990.4739138051144, 516.6732874444265, 731.7542174027417, 1682.1423931696672, 658.2721256927183, 742.9745175036714, 5558.356615655481, 730.7580617921499, 1129.6909742306132, 2397.188743083273, 4616.087219222087, 877.0503779245806, 842.0963530035381, 562.422266885638, 187.35092773043797, 4273.885221089827, 3234.859835525143, 1357.1495715622625, 2669.761977624999, 5052.247653377117, 39.08447204350022, 758.7033120131557, 24.238353483245344, 7413.767784189055, 1898.976228029494, 771.8309453398165, 3462.3094605233377, 2026.4759777218887, 3996.5796517763856, 1425.2929139867592, 26.33940480293836, 5944.4065777893675, 6305.607935835796, 1931.579744487984, 959.7313966987928, 3996.0295112973536, 910.8144361308489, 1142.4962866093388, 1776.6647168195418, 5704.851793378491, 569.1062275818266, 6790.611557498897, 2147.0061269144426, 3565.7476672658563, 1629.469488704534, 1075.9650967019206, 4155.229691477757, 3875.7398438548307, 26.47556023441705, 6529.844601226746, 28.983876580010865, 2614.199840225774, 933.7373239423513, 4132.573975100477, 24.97321048424898, 1717.3581337836288, 4020.170391793749, 29.58261536641709, 1389.8800816741168, 976.115228863526, 1157.9160799973, 3461.7321007669225, 824.5218507988458, 605.471537494852, 41.12240214513259, 991.6773508259184, 3968.65646025797, 2963.315218504699, 5744.525461880653, 751.3137575239538, 1063.3359042437864, 1136.6049137048353, 1595.0578333364606, 6294.257504945576, 6744.036093211336, 1319.6527156010961, 991.0044350561406, 23.393779407031005, 775.1176780094828, 22.554706820090505, 1862.2673180473396, 3372.9587187402763, 3175.3679912069356, 2955.3322396953463, 2558.3556602293843, 3356.0537107105697, 597.3821494129205, 17.892577727088337, 562.6687883942203, 533.7799133801179, 22.338944295004097, 6603.702449060639, 4032.683816796727, 574.8416142876383, 855.3799840034395, 5098.006774931025, 1587.129376026533, 659.9137189267849, 34.595667852855605, 703.6603228521815, 2405.3389187267176, 2279.202220324368, 3958.8921427891223, 5988.844843635976, 2185.468984678577, 5353.544508994616, 2364.1697584494145, 3324.731236613885, 2024.8275538516482, 1216.8982837685837, 4808.401330704351, 2693.1222754104415, 686.5318222380643, 611.8784187235348, 1568.1264632921182, 4138.299946183317, 29.556152539255805, 1907.7943558725492, 2975.896450583192, 7018.91061956463, 1305.2355005167162, 31.24680974247878, 23.135314081103378, 2315.387536727585, 24.909479839678152, 878.1602946538922, 827.4015840220637, 905.6941031516359, 6197.627407410919, 3286.602044329692, 5845.8550592717165, 1593.4668105765838, 879.491118836333, 2741.258780644283, 1513.5974944433858, 1087.7687360478342, 1252.1261900220318, 28.092177445359745, 8088.228014517001, 751.3597727248771, 154.87329493498913, 1086.275520559378, 21.54026248614593, 3078.7958271820735, 979.9183446972105, 22.145048230084342, 1050.642193761375, 6520.1053008540375, 1058.0173632512788, 3979.274008587152, 7847.882823247855, 4741.300209783094, 3389.896670000472, 1074.992462264934, 2172.40702110532, 665.0480851946394, 1093.6180860630698, 25.32604038938282, 646.0380895512913, 1825.4763598301786, 895.0534483754323, 1295.45482399362, 582.4682323255204, 1433.5033773179732, 4028.5977044255983, 2878.764801124054, 1309.424371210885, 7040.566872140948, 27.959441995301344, 5953.196646487035, 3000.0041453996905, 1112.2243879055643, 4435.259378161256, 1349.812605879199, 1116.767728063696, 2512.7542980049066, 19.823822573265815, 2194.5991202676537, 2497.5568910240245, 7366.4866488971065, 1391.424926232817, 3875.0555740262903, 1348.4871022077787, 644.7362473870859, 1097.4038124782849, 2656.2060614605352, 2032.7127888027615, 37.70584569378094, 3245.5340628917706, 24.360703402331676, 28.92333540069745, 670.938391795376, 968.3905616242647, 5965.130619883474, 59.16584111983083, 6194.571979075943, 2761.626486357393, 2013.6027162356609, 836.7255050896562, 2792.36007020083, 1352.9524744873595, 1064.9509628419637, 879.2467823871077, 486.5744739874432, 20.980669746663413, 1112.1514405824785, 24.812629868093985, 22.675382786196685, 3788.553856055606, 486.0197932721683, 2572.5302564497333, 677.2272034238844, 5047.473588427927, 1490.8553779980325, 1673.781313703851, 1544.2695164914564, 1015.7054217895446, 783.9352141225206, 800.1786459448928, 1828.4147257478407, 1099.023166248835, 651.5405754615288, 46.57035165961471, 779.3744203820232, 22.011077043015334, 526.4470705438536, 1032.2363300471218, 3937.8524773359004, 33.08452857969672, 576.3923354288153]


biases=[]
parity_rate=[]
for i in range(len(parity_rate_data)):
    if parity_rate_data[i] < 5000 and parity_rate_data[i] > 200:
        biases.append(biases_data[i])
        parity_rate.append(parity_rate_data[i])

biases1=[]
parity_rate1=[]
for i in range(len(parity_rate_data1)):
    if parity_rate_data1[i] < 5000 and parity_rate_data1[i] > 200:
        biases1.append(biases_data1[i])
        parity_rate1.append(parity_rate_data1[i])


plt.title('Parity Rate vs Radiator Bias')
# plt.plot(4*times, np.abs(I + Q * 1j))
plt.semilogy([np.abs(b/0.49) for b in biases1], parity_rate1,marker='o',linestyle='None')
plt.semilogy([np.abs(b-0.0237) for b in biases], parity_rate,marker='+',linestyle='None')

plt.grid(which='both')
plt.ylim(0.4e3,8e3)
#plt.xlim(-600,600)
# plt.xlabel('Radiator Bias (mV)')
plt.xlabel('Radiator Bias (mV)')
plt.ylabel('Parity Rate (Hz)')
plt.pause(0.1)

