from datetime import datetime
from scipy import signal
from dataChest import *
import os
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
import matplotlib
matplotlib.use('TkAgg')

# Z:\mcdermott-group\data\Axion\2022-09-22 - DR2\DCH\Axion3A\10-10-22\PSD_Q4_J2B
biases_data = [-0.09603999999999997, -0.07741999999999996, 0.04998000000000007, 0.07056000000000016, -0.013719999999999902, 0.06860000000000017, -0.11661999999999999, -0.11563999999999999, -0.11073999999999999, -0.04311999999999993, -0.09995999999999998, 0.012740000000000038, -0.20579999999999996, 0.02450000000000005, 0.08036000000000018, -0.12054, 0.1078000000000002, -0.06173999999999995, 0.12250000000000014, -0.026459999999999997, -0.08525999999999996, -0.06565999999999995, 0.022540000000000046, 0.020580000000000046, -0.08721999999999996, -0.049979999999999934, 0.0970200000000001, 0.05096000000000015, -0.08819999999999997, -0.05193999999999994, -0.006859999999999979, -0.07153999999999995, -0.08231999999999996, 0.02744000000000013, -0.09015999999999998, -0.03821999999999993, -0.05879999999999994, -0.2646, -0.2841999999999999, -0.01861999999999999, 0.00294000000000003, 0.03822000000000006, 0.05390000000000007, 0.021560000000000128, -0.027439999999999916, -0.08427999999999997, -0.023519999999999913, 0.11270000000000012, -0.05389999999999994, 0.05684000000000016, 0.06762000000000008, 0.06272000000000016, -0.004899999999999977, 0.06566000000000008, -0.11857999999999999, -0.08329999999999996, -0.08133999999999997, -0.07643999999999995, 0.07154000000000009, 0.09506000000000012, 0.0960400000000002, 0.01568000000000012, -0.05291999999999994, 0.06958000000000009, -0.046059999999999934, -0.040179999999999924, 0.07938000000000009, -0.012739999999999984, -0.18619999999999995, 0.11172000000000021, 0.03528000000000014, -0.03527999999999992, -0.16659999999999991, 0.019600000000000124, -0.017639999999999906, 0.09310000000000011, -0.04213999999999993, 0.11074000000000013, -0.09897999999999997, 0.0891800000000001, -0.0117599999999999, -0.245, 0.08134000000000009, 0.11858000000000013, -0.034300000000000004, 0.11662000000000013, 0.10290000000000012, -0.08035999999999996, 0.09212000000000019, 0.11564000000000021, -0.06467999999999995, 0.02548000000000013, -0.07055999999999996, -0.050959999999999936, -0.0009799999999999737, 0.017640000000000124, -0.10583999999999999, 0.007840000000000116, 0.1176000000000002, -0.3626, -0.022539999999999994, 0.049000000000000155, 0.10682000000000012, -0.10387999999999999, -0.02155999999999991, 0.08624000000000018, 0.052920000000000154, -0.09799999999999998, -0.1469999999999999, -0.09701999999999998, 0.04802000000000007, -0.028419999999999997, 0.06174000000000008, 0.11956000000000021, -0.03234, 0.05194000000000007, 0.004900000000000031, 0.0833000000000001, -0.07545999999999996, 0.05488000000000016, -0.060759999999999946, -0.04801999999999993, 0.07252000000000017, 0.09898000000000011, 0.039200000000000144, 0.06664000000000017, 0.043120000000000144, -0.05585999999999994, -0.09309999999999997, 0.055860000000000076, 1.0880185641326534e-16, -0.10877999999999999, 0.010780000000000036, -0.06761999999999994, -0.07349999999999995, -0.03919999999999992, 0.05782000000000008, -0.01959999999999991, 0.005880000000000114, -0.1127, -0.10093999999999997, -0.015679999999999906, 0.046060000000000066, -0.06369999999999995, -0.005879999999999897, -0.05781999999999994, 0.07350000000000009, 0.0774200000000001, -0.11956, -0.029399999999999916, 0.1058400000000002, 0.008820000000000034, -0.07937999999999996, -0.03038, 0.10094000000000011, 0.059780000000000076, 0.0754600000000001, 0.03724000000000014, -0.1176, 0.023520000000000128, 0.0009800000000000282, -0.10975999999999998, -0.10191999999999998, 0.10192000000000019, 0.07448000000000017, 0.032340000000000056, 0.0999600000000002, -0.08623999999999997, 0.0852600000000001, 0.11368000000000021, -0.02057999999999999, 0.12152000000000021, -0.2254, 0.1038800000000002, 0.02646000000000005, -0.024499999999999994, -0.007839999999999897, -0.06663999999999995, -0.07447999999999996, -0.07839999999999996, 0.09016000000000018, -0.009799999999999899, -0.003919999999999895, -0.04507999999999993, 0.08428000000000019, 0.006860000000000033, -0.11367999999999999, 0.06076000000000016, -0.014699999999999986, 0.016660000000000043, 0.04410000000000006, -0.10485999999999998, 0.1097600000000002, -0.04899999999999993, 0.11466000000000012, 0.08232000000000018, -0.04703999999999993, 0.05880000000000016, -0.12347999999999999, -0.07251999999999996, -0.06859999999999995, -0.03331999999999992, -0.016659999999999987, -0.001959999999999893, 0.0872200000000001, 0.06370000000000008, 0.07840000000000018, 0.04018000000000006, -0.041159999999999926, -0.002939999999999975, 0.013720000000000121, -0.00881999999999998, 0.10878000000000013, -0.010779999999999982, -0.09113999999999997, -0.10681999999999998, 0.009800000000000118, -0.05683999999999994, -0.059779999999999944, -0.32339999999999997, 0.09114000000000011, 0.036260000000000056, 0.0980000000000002, 0.01470000000000004, 0.10486000000000012, -0.10289999999999998, -0.037239999999999926, -0.06271999999999994, -0.10779999999999998, 0.0019600000000001105, -0.34299999999999997, 0.12054000000000013, -0.09505999999999998, -0.12152, -0.025479999999999912, -0.09407999999999997, 0.04116000000000015, -0.11171999999999999, -0.036259999999999924, -0.031359999999999916, 0.03136000000000014, 0.018620000000000043, -0.1225, 0.06468000000000017, -0.08917999999999997, -0.06957999999999995, 0.003920000000000113, 0.03332000000000014, -0.09211999999999997, -0.10779999999999988, 0.042140000000000066, 0.04704000000000015, -0.1273999999999999, 0.09408000000000019, 0.01176000000000012, 0.04508000000000015, -0.11465999999999998, 0.08820000000000018, -0.30379999999999996, 0.030380000000000053, -0.054879999999999936, 0.07644000000000017, 0.029400000000000134, 0.028420000000000053, 0.03430000000000006, -0.04409999999999993]
parity_rate_data = [1199.6664565123556, 433.64697848299915, 522.2045129937384, 331.9159802287976, 114.65126126862377, 338.813063565473, 2175.95795863804, 2165.899348496834, 1637.021548168034, 829.6392729033487, 1261.6626382645707, 91.99978866498451, 27.502607411282167, 383.4007450255458, 744.3216430597158, 2232.106468349297, 1552.094871648386, 755.2914224806196, 2153.193339688825, 471.24379612506795, 727.6412525186121, 460.9547194429838, 397.75946413906536, 398.0145733106211, 844.1964397632894, 511.72240120291826, 1245.190739206556, 521.6179221221801, 850.6974324603818, 543.0490763084381, 71.09400377536574, 329.1308428655885, 682.0454115143978, 493.0912957076494, 856.7336638089519, 989.3287705186996, 990.6678187817083, 24.363720073318213, 61.66505557182625, 318.39340585781554, 73.90969467638854, 1146.983909149044, 694.9265645554823, 451.2994511162882, 482.65404211627174, 704.3496365796422, 337.8468669296772, 1985.9608521486477, 632.6168242664452, 924.2964324567515, 350.17754033361183, 634.5553225671524, 69.55291336086766, 418.85750358686323, 2183.114372417507, 655.7407015916694, 689.8638203374625, 406.0684115907181, 330.3910964796653, 1139.761369587299, 1241.471651606855, 194.77717242452033, 577.1279610808689, 325.85420766298375, 554.090137708125, 983.4101366181566, 628.4510552029213, 87.11285858947676, 3417.8899170365107, 1981.661979404863, 755.3604680376219, 664.619533608338, 3567.2930791980184, 265.3847422914757, 289.59243025315556, 965.2301998094254, 952.4664339604368, 1889.9694855005212, 1243.6197064261198, 839.0708932684654, 89.01094855489738, 31.079983658172285, 670.7326673963195, 2299.475509671417, 637.7051738680449, 2219.119085519484, 1428.1975566497294, 665.9117490849386, 926.1896845872633, 2147.360993243212, 497.75635345577734, 482.8930984331809, 332.2227329367967, 502.7821880773372, 67.20558286463968, 230.4092320076787, 1493.4500293501635, 75.88278521475614, 2322.2650010204707, 26.28301507409139, 468.137601088983, 515.6520920905034, 1517.841661556814, 1439.017117039653, 415.84111675043295, 814.8004360037388, 617.7998298665921, 1202.2490565418518, 2838.3502962190273, 1242.906820106023, 536.9446419848053, 473.0882019623335, 687.0246921668323, 2328.600378234576, 664.1554350431462, 578.9286057925385, 75.1750296242799, 697.3638990513339, 400.7519448961872, 793.772449667653, 819.1857226855535, 518.072079434302, 355.70112901880304, 1314.0487457414888, 1066.4147446947998, 386.52936538931925, 676.0334962840633, 800.0770932658379, 880.8499972893112, 866.6451320648707, 66.95500223766874, 1504.0872505878451, 89.70386795731572, 374.3274453811288, 358.2119436443163, 1287.820017605301, 1031.2360051595429, 407.0682905769141, 68.43765274096317, 2049.725396627705, 1273.6792950390131, 202.89066125181083, 551.5005362811864, 559.5058886653753, 75.32107350937184, 977.7347034038105, 375.7469013335493, 473.0483719776412, 2281.0527735712126, 563.301107307344, 1522.4291495795371, 77.4229533764707, 537.72214601089, 594.1341654057546, 1328.5967514279428, 842.0146846956656, 389.1470855720121, 986.9618366814957, 2215.022792124647, 360.33641309614535, 72.7561566252549, 1543.1130865712962, 1272.3127594243567, 1362.4383994127827, 405.31162922706073, 660.3013292448294, 1317.5178197769033, 779.2593613474883, 796.1754340128589, 2024.6084943026142, 493.9952047327824, 2326.00445923998, 27.094704639306865, 1463.4468589037226, 484.4717114380383, 348.13945145534257, 77.6279794553426, 408.4250933877005, 394.8405351809085, 475.545791812874, 843.7493495446536, 73.99054619100073, 69.52685721074805, 613.6100253566499, 753.9879326190475, 74.91398134506075, 2040.1408590833082, 799.6843080252171, 140.85864087263323, 213.70111523225407, 626.9811809337241, 1461.1922221545199, 1571.4745826684011, 505.46060476490595, 2048.2264889431267, 709.977150911144, 531.2968523954995, 989.4112834245022, 2271.1765569412432, 339.66947213899505, 329.71357036312264, 671.2175588486527, 230.15462903384505, 66.9115824337707, 863.563816599716, 532.2614005225603, 504.5411318818797, 963.512729516543, 1000.9029946333061, 64.95947896482046, 125.35064097280203, 76.51406885650762, 1499.7759692525913, 74.67376748763202, 892.9580987587715, 1488.4337523682013, 70.58461422296539, 906.1973960670819, 966.3335058093552, 57.99173400318439, 906.6876460774124, 831.9550585037668, 1219.5163051650452, 141.55352220007072, 1479.3840046235837, 1432.1121768473101, 877.5409255585334, 637.6909222837797, 1538.135708024238, 65.73109626163534, 27.173665034663312, 2348.7676593897245, 1065.3801715480286, 2264.629325864625, 400.6469974420539, 972.8093978493301, 1037.01500988296, 1898.5380453353205, 785.7327993426735, 647.6793513063578, 689.6332444981834, 276.05883066321616, 2076.1472165970795, 482.29762176394985, 833.8652692075099, 330.21532559286214, 64.62129553052894, 625.3560913321313, 914.2732229582215, 1479.7590931695192, 874.6781498470522, 521.1002738831592, 2188.5156540174667, 1056.2969760270691, 85.94266556912626, 562.0870638972115, 2024.9794928602303, 854.4052699506793, 53.388892684038346, 622.5027803014399, 733.8108723271167, 418.749377116645, 600.4114555076497, 548.4426311705606, 663.5603764352204, 703.3715143102123]

biases=[]
parity_rate=[]
for i in range(len(parity_rate_data)):
    if parity_rate_data[i] < 5000 and parity_rate_data[i] > 55:
        biases.append(biases_data[i])
        parity_rate.append(parity_rate_data[i])

plt.title('Parity Rate vs Radiator Bias')
plt.semilogy([np.abs(b/0.49) for b in biases], parity_rate,marker='+',linestyle='None')

plt.grid(which='both')
plt.ylim(0.5e2,4.5e3)
plt.xlim(0,0.4)
# plt.xlabel('Radiator Bias (mV)')
plt.xlabel('Radiator Bias (mV)')
plt.ylabel('Parity Rate (Hz)')
plt.pause(0.1)

