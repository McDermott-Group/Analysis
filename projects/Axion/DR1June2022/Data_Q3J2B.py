from datetime import datetime
from scipy import signal
from dataChest import *
import os
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

# biases_data=[-0.2, -0.18000000000000002, -0.16000000000000003, -0.14000000000000004, -0.12000000000000005, -0.10000000000000006, -0.08000000000000007, -0.06000000000000008, -0.04000000000000009, -0.0200000000000001, -1.1102230246251565e-16, 0.01999999999999988, 0.03999999999999987, 0.05999999999999989, 0.07999999999999985, 0.09999999999999981, 0.11999999999999983, 0.13999999999999985, 0.1599999999999998, 0.17999999999999977, 0.1999999999999998, 0.2199999999999998, 0.23999999999999977, 0.25999999999999973, 0.27999999999999975, 0.29999999999999977, 0.3199999999999998, -0.21, -0.19, -0.17, -0.15000000000000002, -0.13000000000000003, -0.11000000000000004, -0.09000000000000005, -0.07000000000000006, -0.05000000000000007, -0.030000000000000082, -0.010000000000000092, 0.009999999999999898, 0.029999999999999888, 0.049999999999999906, 0.06999999999999987, 0.08999999999999983, 0.10999999999999985, 0.12999999999999987, 0.14999999999999983, 0.1699999999999998, 0.1899999999999998, 0.20999999999999983, 0.2299999999999998, 0.24999999999999975, 0.2699999999999998, 0.2899999999999998, 0.30999999999999983, -0.06, -0.057999999999999996, -0.055999999999999994, -0.05399999999999999, -0.05199999999999999, -0.04999999999999999, -0.04799999999999999, -0.045999999999999985, -0.043999999999999984, -0.04199999999999998, -0.03999999999999998, -0.03799999999999998, -0.035999999999999976, -0.033999999999999975, -0.03199999999999997, -0.02999999999999997, -0.02799999999999997, -0.025999999999999968, -0.023999999999999966, -0.021999999999999964, -0.019999999999999962, -0.01799999999999996, -0.01599999999999996, -0.013999999999999957, -0.011999999999999955, -0.009999999999999953, -0.007999999999999952, -0.00599999999999995, -0.003999999999999948, -0.0019999999999999463, 5.551115123125783e-17, 0.0020000000000000573, 0.004000000000000059, 0.006000000000000061, 0.008000000000000063, 0.010000000000000064, 0.012000000000000066, 0.014000000000000068, 0.01600000000000007, 0.01800000000000007, 0.020000000000000073, 0.022000000000000075, 0.024000000000000077, 0.02600000000000008, 0.02800000000000008, 0.030000000000000082, 0.032000000000000084, 0.034000000000000086, 0.03600000000000009, 0.03800000000000009, 0.04000000000000009, 0.04200000000000009, 0.044000000000000095, 0.046000000000000096, 0.0480000000000001, 0.0500000000000001, 0.0520000000000001, 0.054000000000000103, 0.056000000000000105, 0.05800000000000011, 0.06000000000000011, 0.06200000000000011, 0.06400000000000011, 0.06600000000000011, 0.06800000000000012, 0.07000000000000012, 0.07200000000000012, 0.07400000000000012, 0.07600000000000012, 0.07800000000000012, 0.08000000000000013, 0.08200000000000013, 0.08400000000000013, 0.08600000000000013, 0.08800000000000013]
# parity_rate_data=[4254.8354309519045, 4025.044988655798, 3549.09037247466, 2964.339020510612, 2302.6513321772704, 1710.1051158781208, 1278.8423950829058, 973.2448172219578, 731.91138172473, 585.8183239342208, 515.8692916163527, 511.02696333432954, 529.0211198429399, 537.0087845831857, 617.4425362709098, 819.5995000792144, 1121.9847875886765, 1502.4247844335664, 2300.8665250546323, 3472.544985361231, 4949.494150173139, 6187.735524988079, 22.57690882520166, 40.59325367761087, 48.945092330882645, 33.631228301149164, 31.73512919292388, 38.831312078595516, 7394.480603477022, 105.60353916441625, 34.45621405265674, 74.33910355336774, 14.841034637937522, 1487.1048005782322, 1073.3674485011632, 934.1961680059243, 643.5840456480713, 528.1692772379434, 516.6967642941963, 509.1057242887633, 514.2166627755696, 567.6984634359316, 673.1868441694508, 924.7333596867833, 1203.3071645391394, 1641.8399869903164, 2211.4237010832085, 2830.8039457411364, 3424.5984468910874, 3853.361414456382, 4164.640160376726, 4372.1450470169575, 15.323090476733837, 29.6988881864453, 939.3564574997758, 948.6485458331348, 954.6077251629004, 919.8728958840809, 917.6760099055106, 894.2544205914708, 920.6380756144115, 809.9562804717376, 784.2028898103225, 769.8699698636044, 736.6797269246919, 716.8398232468134, 699.4910975379378, 691.6916413893168, 673.4018990244741, 664.2440287613366, 637.7177098969028, 637.9776157743032, 616.632770109728, 599.207451968575, 593.7115975196667, 587.7977782660166, 582.0125640436254, 571.375429706195, 552.7972717972165, 541.7302895209405, 547.8311270008612, 542.451709718839, 544.9534321554336, 520.448387943147, 526.9450640479085, 539.8058963985208, 517.5831150354248, 528.3692155440904, 530.2933880263184, 529.2282406253419, 513.1916007039167, 513.8987272627855, 519.7403448717164, 512.2815131702783, 514.8155778803648, 522.6981731136672, 525.2646380274002, 506.63423976866454, 520.0930072925453, 520.363577977929, 519.7369685572642, 531.1736629549698, 500.575110056812, 516.9904418206609, 523.7289969808538, 524.8809153624023, 524.0978190267177, 508.863000504972, 515.5047707369392, 508.1765157242161, 520.4405076761807, 517.1071721007996, 534.9412382873003, 531.6430162920188, 536.2223291144046, 526.2149639355147, 536.3502298488218, 541.4525423222995, 558.9711937296811, 561.0684922417385, 568.9535635963186, 587.3486965172534, 586.1394709970743, 600.7356075846498, 610.6955262057447, 642.7668093721956, 656.5260009897708, 665.9318852336352, 691.0483379934013]

#at -1500uA Flux Bias
biases_data=[-0.23, -0.22, -0.21, -0.19999999999999998, -0.18999999999999997, -0.17999999999999997, -0.16999999999999996, -0.15999999999999995, -0.14999999999999994, -0.13999999999999993, -0.12999999999999992, -0.11999999999999991, -0.1099999999999999, -0.0999999999999999, -0.08999999999999989, -0.07999999999999988, -0.06999999999999987, -0.05999999999999986, -0.04999999999999985, -0.03999999999999984, -0.029999999999999832, -0.019999999999999823, -0.009999999999999815, 1.942890293094024e-16, 0.010000000000000203, 0.020000000000000212, 0.03000000000000022, 0.04000000000000023, 0.05000000000000024, 0.06000000000000025, 0.07000000000000026, 0.08000000000000027, 0.09000000000000027, 0.10000000000000028, 0.11000000000000029, 0.1200000000000003, 0.1300000000000003, 0.14000000000000032, 0.15000000000000033, 0.16000000000000034, 0.17000000000000035, 0.18000000000000035, 0.19000000000000036, 0.20000000000000037, 0.21000000000000038, 0.2200000000000004, 0.2300000000000004, 0.2400000000000004, 0.25000000000000044, 0.26000000000000045, 0.27000000000000046, -0.086, -0.08399999999999999, -0.08199999999999999, -0.07999999999999999, -0.07799999999999999, -0.07599999999999998, -0.07399999999999998, -0.07199999999999998, -0.06999999999999998, -0.06799999999999998, -0.06599999999999998, -0.06399999999999997, -0.06199999999999997, -0.05999999999999997, -0.05799999999999997, -0.055999999999999966, -0.053999999999999965, -0.05199999999999996, -0.04999999999999996, -0.04799999999999996, -0.04599999999999996, -0.043999999999999956, -0.041999999999999954, -0.03999999999999995, -0.03799999999999995, -0.03599999999999995, -0.03399999999999995, -0.031999999999999945, -0.029999999999999943, -0.02799999999999994, -0.02599999999999994, -0.023999999999999938, -0.021999999999999936, -0.019999999999999934, -0.017999999999999933, -0.01599999999999993, -0.01399999999999993, -0.011999999999999927, -0.009999999999999926, -0.007999999999999924, -0.005999999999999922, -0.00399999999999992, -0.0019999999999999185, 8.326672684688674e-17, 0.002000000000000085, 0.004000000000000087, 0.006000000000000089, 0.00800000000000009, 0.010000000000000092, 0.012000000000000094, 0.014000000000000096, 0.016000000000000097, 0.0180000000000001, 0.0200000000000001]+[0.0200000000000001, 0.022000000000000103, 0.024000000000000105, 0.026000000000000106, 0.028000000000000108, 0.03000000000000011, 0.03200000000000011, 0.03400000000000011, 0.036000000000000115, 0.03800000000000012, 0.04000000000000012, 0.04200000000000012, 0.04400000000000012, 0.046000000000000124, 0.048000000000000126, 0.05000000000000013, 0.05200000000000013, 0.05400000000000013, 0.05600000000000013, 0.058000000000000135, 0.06000000000000014, 0.06200000000000014, 0.06400000000000014, 0.06600000000000014, 0.06800000000000014, 0.07000000000000015, 0.07200000000000015, 0.07400000000000015, 0.07600000000000015, 0.07800000000000015, 0.08000000000000015]+[0.08000000000000015, 0.08200000000000016, 0.08400000000000016, 0.08600000000000016, 0.08800000000000016, 0.09000000000000016, 0.09200000000000016, 0.09400000000000017, 0.09600000000000017, 0.09800000000000017, 0.10000000000000017, 0.10200000000000017, 0.10400000000000018, 0.10600000000000018, 0.10800000000000018, 0.11000000000000018, 0.11200000000000018, 0.11400000000000018, 0.11600000000000019, 0.11800000000000019, 0.12000000000000019, 0.12200000000000019, 0.1240000000000002]
parity_rate_data=[4585.0384027868595, 4538.739447183097, 4473.641913594156, 4395.455338022558, 4218.903228412171, 4057.251143243847, 3947.0100607027293, 3677.361340065246, 3277.293334313241, 3178.660912578685, 4060.1217899901867, 3683.817750894962, 2434.1721264105754, 1921.2972399067235, 1682.3017022136794, 1463.101862649987, 7176.39312314772, 315.3862825063121, 1629.2303220427436, 1113.187351891625, 1029.5426478028605, 823.1038569952714, 618.6121729991078, 539.8610473049292, 25.737013875538388, 9999.802425667882, 2517.6178695658728, 2079.5030053091223, 715.3506611446729, 673.3878053677331, 29.36075032391231, 10.000079841135765, 1016.0440752505784, 1245.8176017246128, 1499.3656609762043, 1278.4668656141337, 1390.2944333260555, 1563.1580369779804, 1756.5194946621825, 2093.7757952507422, 2467.552100543232, 2824.4934781458483, 2908.134454520922, 3205.508766871172, 3546.5291394514907, 3827.1934539062345, 5953.817705959159, 33.28432357694396, 32.265297291816964, 31.723233492465422, 41.524668369645966, 1581.264083087569, 1559.5738183505225, 1512.90664640742, 1486.9837764078031, 1441.908310737864, 1392.6083116661885, 1366.6567510505488, 1343.6960808567042, 1321.4446251870186, 1293.8539926594913, 1261.3637153354523, 1296.2331525404384, 1321.3873846352722, 1378.5005946185106, 1394.6547494045144, 1471.0397186232144, 1499.3466372358455, 1530.989783396921, 1600.9270437333469, 1537.212722558515, 1318.288478318913, 1195.1565965915224, 1106.2080853501334, 1048.1208956381386, 1051.7002038607984, 1018.4950764295853, 1029.5386320668645, 976.539531347189, 997.1978459105482, 947.5447738648686, 919.8848393258414, 872.6753703545448, 850.4809634133464, 791.9645163911306, 757.5327883043907, 707.9417636766815, 669.7671980114529, 658.01568180064, 623.7077233443049, 580.6435039708306, 564.5126396831364, 555.1539508255241, 525.9774172234892, 540.6553107546008, 543.5366085455618, 539.6608240551094, 524.873167357142, 544.0700050183872, 527.4852691045337, 527.3726392966488, 539.8685070816834, 542.4707338599161, 524.8301515250388, 537.6267904827611]+[537.6267904827611, 540.9748471440847, 544.360793836746, 534.8685466654474, 536.7100831167957, 542.7971345213282, 541.5111926417691, 529.7721137575427, 541.5318972721021, 523.1920082616604, 536.3100961426879, 535.0842972038247, 530.740205864999, 540.345262700669, 532.4637802782779, 536.6321480080319, 521.9939498147723, 521.5021874091079, 541.0181926158683, 551.1837790442565, 541.3748494135339, 558.238827178536, 578.3981673321807, 627.8220029823012, 644.1494917013123, 699.1844050458226, 739.8438028685603, 785.1117315172505, 823.470249867888, 873.9710956526717, 895.5172743027252]+[895.5172743027252, 931.5453929689259, 977.1928473360864, 982.1033518923724, 1022.5858409675743, 1026.199753353408, 1049.7821181596532, 1054.4255312935811, 1081.1105150044923, 1140.7008628332087, 1266.8218555760566, 1400.1655980453875, 1561.7120389253628, 1547.0496831136065, 1497.2313408086325, 1497.105704242333, 1423.322269477896, 1381.8980488125135, 1336.2140188497497, 1302.860251756133, 1304.7445949049047, 1279.4654974877417, 1281.8642633277218]

biases=[]
parity_rate=[]
for i in range(len(parity_rate_data)):
    if parity_rate_data[i] < 5000 and parity_rate_data[i] > 0:
        biases.append(biases_data[i])
        parity_rate.append(parity_rate_data[i])

plt.title('Parity Rate vs Radiator Bias')
# plt.plot(4*times, np.abs(I + Q * 1j))
plt.semilogy([(b-0.028)*(490)*(0.02)*484 for b in biases], parity_rate,marker='.',linestyle='None')
plt.grid(which='both')
plt.ylim(4e2,5e3)
plt.xlim(-500,500)
# plt.xlabel('Radiator Bias (mV)')
plt.xlabel('Radiator Frequency (GHz)')
plt.ylabel('Parity Rate (Hz)')
plt.pause(0.1)

print([(b,(b-0.05)*(490)*(0.02)*484) for b in biases])

